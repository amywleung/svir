---
title: "Local Social Vulnerability Index"
author: "Amy Leung and Maximilian Pschorr"
date: "`r Sys.Date()`"
output: 
  slidy_presentation: 
    default:
    fig_height: 4
    fig_width: 1
    css: slides.css
subtitle: A Shiny Application for Calculating and Visualizing Local SVI
vignette: >
  %\VignetteIndexEntry{SVI Presentation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r html_doc, eval=FALSE, include=FALSE}
library(rmarkdown)
render(input = "Leung-Pschorr-SVI.Rmd", output_format = "html_document", output_file = "Leung-Pschorr-SVI.html")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
``` 

## Social Vulnerability

<br></br>

-"Social vulnerability refers to the **resilience of communities** when confronted by external stresses..." [(ATSDR 2013)](https://svi.cdc.gov/)
    + In particular, the degree of resilience (or lack thereof) stemming from socio-economic factors
    + Not geophysical qualities
    
-Difficult to quantifying
    + A multitude of contributing factors
    + Difficult to measure
    + Reaction between socio-economic qualities

3. The Social Vulnerability Index
    + An multi-level approach to quantifying social vulnerability
    + A complex index to measure complex phenomena

## The Social Vulnerability Index - Concept

<center> Center for Disease Control<br>-</br><b> Agency for Toxic Substances and Disease Registry</br></center><br></br>

1. Census and American Community Survey input variables <br></br>
    + Identify potentially less resilient communities, in order to help inform disaster preparation, mitigation, and reconstruction policies and undertakings [(ATSDR)](https://svi.cdc.gov/Documents/FactSheet/SVIFactSheet.pdf)
    
2.  Multiple versions of the index
    + 2000, 2010, and 2014 indexes
    + This project is a modification of the 2014 implementation
    + 2014 ACS variables at the census tract level

3. Relative ranks / multi-tiered index <br></br>
    + Variables normalized by population
    + A census tract's SVI value is relative, rather than a direct measure
    + 40 indicators are generated for every census tract

## The Social Vulnerability Index - Data

1. <u><b>15 Aggregate ACS Variables</b></u> (Tier 1)
  
    1.1. <font color="#47d147"> Below poverty,  unemployed, income, no high school diploma</font> 
   
    1.2. <font color="#ffa31a"> Aged 65 or older, aged 17 or younger, civilian with a disability, single-parent   household</font> 
  
    1.3. <font color="#b300b3"> Minority, speak English "Less than Well"</font> 
   
    1.4. <font color="#3366ff"> Multi-unit Structures, mobile homes, crowding, no vehicle, group quarters</font> 
   
To arrive at the index value for each variable, one calculates the <u>precentile rank</u> of the <u>sum</u> of their constituent <u>ACS variables</u>.
   
2. <u><b>Four Thematic Domains</b></u> (Tier 2)
  
    2.1. <font color="#47d147"> Socioeconomic Status</font> 
   
    2.2. <font color="#ffa31a"> Household Composition & Disability</font> 
  
    2.3. <font color="#b300b3"> Minority Status & Language</font> 
   
    2.4. <font color="#3366ff"> Housing & Transportation</font> 

To arrive at the index value for each Thematic Domain, one calculates the <u>percentile rank</u> of the <u>sum</u> of their constituent <u>tier 1 variable percentile ranks</u>.

## The Social Vulnerability Index - Data (continued)

<br></br>

3. Overall SVI Rank (Tier 3) <br></br>
The Overall SVI rank is calculated in following the same methodology as the Thematic Domains. The index value is the percentile rank of the summed Thematic Domains percentile rank values.

<br></br>

<font color="#ED5E11"><center>Equation for Percentile Rank Value:
<i>Percentile Rank</i>  = <u>(Rank - 1) / (N - 1)</u></center></font>

<br></br>

4. Index Variable Flags
    + Higher tiers of the index provide a more genearlized conception of vulnerability by combining variables. This generalization has the unfortunate effect of masking extreme vulnerability in particular variables.
    + Census tracts that rank in the 90th percentile are assigned flags for each element in all three tiers.


## The Data - Part II

1. Regional Version of the Index
   Currently available at State / National Level

## Methods - Dealing with Data

<br></br>

1. Storing Data
    + USA wide dataset is considerable
    + Providing a service - consider the user
    + By design, the user will not need the full dataset
    
##

<center>
72,842 Census Tracts, <br></br> 126 Columns of Information, 1 Column of Vector Geometry
<br></br>

```{r, out.width = "900px", echo=FALSE}
knitr::include_graphics("../figs/usCT_noAkHi.png")
```

423MB
</center>

## Methods - Dealing with Data

<br></br>

1. Storing Data
    + USA wide dataset is considerable
    + Providing a service - consider the user
    + By design, the user will not need the full dataset

2. PostgreSQL
    + Alternative repository to storing the data in static file

##

<br></br>
<center>
```{r, out.width = "900px", echo=FALSE}
knitr::include_graphics("../figs/pgAdmin4_svi2014us_table.png")
```

pgAdmin4 - Graphic User Interface for managing PostgreSQL Databases

</center>
<br></br>


## Methods - Dealing with Data

<br></br>

1. Storing Data
    + USA wide dataset is considerable
    + Providing a service - consider the user
    + By design, the user will not need the full dataset

2. PostgreSQL
    + Alternative repository to storing the data in static file

3. PostGIS extension of PostgreSQL
    + User defined Area of interest (AOI) geometry
    + Intersection of user AOI and USA wide dataset
    + Return only relevant census tracts and associated data


## Methods - Calculating the Index

<br></br>

1. Call data from database (SQL Query)
    + <font color=red>`rpostgres`</font> and SQL query statement
    + Select everything from USA Dataset that is intersected by user input AOI
    + Load data into memory as <font color=red>`SpatialPolygonsDataFrame`</font>

2. Recalculation - Rank variables, Identify flags
    + Tier 1
    + Thematic Domains
    + Overall SVI

3. <font color=red>`svi_calc`</font> Function
    + Rank variable
    + Calculate Percentile Rank
    + Assign value to flag columns for census tracts falling into 90th percentile

## Methods - UI : input  ( or is this really results 1?)

<br></br>

1. User selection / input shapefile

2. Shiny is the solution for UI

3. 



## Results 1 - Shiney Web Service

<br></br>


## Results 2 - Visualization

<br></br>


## Results 3 - Output

<br></br>


## Further Work 1

<br></br>

1. Adjust SVI calculation to account for missing values

2. Allow different user input file types

3. Expand user download file type options


## Further Work 2 - Big Tasks

<br></br>

1. New methodology for interpolating smaller areas than census tracts (MAUP) - do we even suggest this?

2. 


## 

<br></br>

<font size="18"><center>
Questions?
</font></center>

## Credits

ATSDR 2013
https://svi.cdc.gov/


https://svi.cdc.gov/Documents/FactSheet/SVIFactSheet.pdf
